$(document).ready(function(){$("button[data-ogc-publish]").click(function(b){var c=$(this).attr("data-ogc-resource");var a=$(this).attr("data-ogc-collection");ngds.publisher.publish(c,a)});$("button[data-ogc-unpublish]").click(function(a){var c=$(this).attr("data-ogc-resource");var b=$(this).attr("data-ogc-layer");ngds.publisher.unpublish(c,b)});ngds.publisher={publish:function(e,c){console.log("Publishing "+e+" "+c);var b=['<div class="modal">','<div class="modal-header">','<button type="button" class="close" data-dismiss="modal">Ã—</button>',"<h3>Publish resource to OGC</h3>","</div>",'<div class="modal-body">','<div class="geoserver-layer-modal">','<label>Geoserver Layer Name</label><input type="text" name="geoserver_layer_name" />',"</div>",'<div id="processing">Please wait while we try to fetch field names in this resource ...</div>',"</div>",'<div class="modal-footer">','<button class="btn btn-cancel">Cancel</button>','<button class="btn btn-primary">Confirm</button>',"</div>","</div>"].join("\n");var a=$(b);var d=a.modal({show:true});ngds.ckanlib.datastore_search(e,function(h){var p=$("<select/>",{"class":"geoserver-lat-selector",name:"lat"});var m=$("<select/>",{"class":"geoserver-lng-selector",name:"lng"});var l=function(q){return q.map(function(r){return $("<option/>",{text:r.id,value:r.id})})};var j=l(h.result.fields);var i=l(h.result.fields);j.map(function(q){p.append(q)});i.map(function(q){m.append(q)});var k=$("<div/>",{});var o=$("<div/>",{});var f=$("<div/>",{});var g=$("<label/>",{text:"Latitude Field"});var n=$("<label/>",{text:"Longitude Field"});k.append(g);k.append(p);o.append(n);o.append(m);f.append(k);f.append(o);$(".modal #processing").replaceWith(f)});a.on("click",".btn-primary",function(f){f.preventDefault();d.modal("hide");ckan.notify("Please wait while this resource is published ...... ","","info");ngds.ckanlib.publish_to_geoserver({layer_name:$("[name=geoserver_layer_name]").val(),resource_id:e,package_id:c,col_geo:"geometry",col_lat:$("[name=lat]").val(),col_lng:$("[name=lng]").val(),callback:function(g){if(g.status==="failure"){ckan.notify("Sorry. The action requested could not be successfully completed.","","error")}else{ckan.notify("This resource has now been published as an OGC service.","","success");window.location.reload()}}})});a.on("click",".btn-cancel",function(f){f.preventDefault();d.modal("hide")})},unpublish:function(b,a){console.log("Unpublishing "+b+" "+a);ckan.notify("Please wait while this resource is published ...... ","","info");ngds.ckanlib.unpublish_layer({layer_name:a,resource_id:b,callback:function(c){if(c.status==="failure"){ckan.notify("Sorry. The action requested could not be successfully completed.","","error")}else{ckan.notify("This resource has now been unpublished","","success");window.location.reload()}}})}}});