ngds.config={number_of_rows:10};if(typeof ngds.Search!=="undefined"){}ngds.feature_event_manager={};ngds.layer_map={};(function setup_control_styles(){ngds.subscribe("Map.loaded",function(a,b){})})();if(typeof ngds.Map!=="undefined"){$(document).ready(function(){ngds.Map.initialize()});ngds.Map.top_level_search=function(){ngds.publish("Map.expander.toggle",{});ngds.pager=new ngds.Search();ngds.publish("Map.search_initiated",{});var b=ngds.Map.get_layer("drawnItems");var a=$("#map-query").val();ngds.util.clear_map_state();ngds.pager.go_to({page:1,action:ngds.ckanlib.package_search,rows:ngds.config.number_of_rows,q:a})}}(function publish_pager_advance(){$("#map-search").click(function(){ngds.Map.top_level_search()});$(".search-results-page-nums").on("click",null,function(a){var b=a.target.firstChild.data;if(b==="<"){b=Number(ngds.Map.cur_page)-1}if(b===">"){b=Number(ngds.Map.cur_page)+1}if(b===0){b=1}if(b>=ngds.Map.num_pages){b=ngds.Map.num_pages}if(typeof b==="undefined"){return}ngds.log("Going to page : "+b);ngds.publish("page.advance",{page:b})})})();(function subscribe_page_advance(){ngds.subscribe("page.advance",function(b,a){ngds.feature_ngds_id_mapping={};ngds.util.clear_map_state();ngds.Map.zoom_handler.clear_listeners();ngds.pager.go_to({page:a.page,action:ngds.ckanlib.package_search,rows:10})})})();(function subscribe_data_loading(){ngds.subscribe("data-loading",function(b,a){ngds.publish("Map.results_hide",{});ngds.Map.map.fireEvent("dataloading")})})();(function subscribe_data_loaded(){ngds.subscribe("data-loaded",function(b,a){ngds.Map.map.fireEvent("dataload")})})();if(typeof ngds.Map!=="undefined"){$(document).ready(function(){ngds.Map.map.on("draw:rectangle-created",function(a){ngds.Map.clear_layer("drawnItems");ngds.Map.add_to_layer([a.rect],"drawnItems");ngds.publish("Map.area_selected",{type:"rectangle",feature:a})});ngds.Map.map.on("draw:poly-created",function(a){ngds.Map.clear_layer("drawnItems");ngds.Map.add_to_layer([a.poly],"drawnItems");ngds.publish("Map.area_selected",{type:"polygon",feature:a})})})}(function subscribe_feature_received(){ngds.subscribe("Map.feature_received",function(a,c){var b=ngds.Map.add_raw_result_to_geojson_layer(c.feature,{seq:c.seq,alph_seq:c.alph_seq});ngds.publish("Map.feature_processed",{feature:b,seq:c.seq})});$(".map-search-results").on("mouseover",null,function(c){var b="";if(typeof c.srcElement==="undefined"){b=c.target}else{b=c.srcElement}var d=ngds.util.node_matcher(b,/result-\d.*/);if(d===null){return}var a={layer:ngds.layer_map[d]};ngds.publish("Layer.mouseover",{Layer:a,tag_index:d})});$(".map-search-results").on("mouseout",null,function(c){var b="";if(typeof c.srcElement==="undefined"){b=c.target}else{b=c.srcElement}var d=ngds.util.node_matcher(b,/result-\d.*/);if(d===null){return}var a={layer:ngds.layer_map[d]};ngds.publish("Layer.mouseout",{Layer:a,tag_index:d})});$(".map-search-results").on("click",".result",function(c){console.log($(this).attr("class"));var b="";console.log("here");if(typeof c.srcElement==="undefined"){b=c.target}else{b=c.srcElement}var d=ngds.util.node_matcher(b,/result-\d.*/);if(d===null||typeof d==="undefined"){return}ngds.util.reset_result_styles();var a={layer:ngds.layer_map[d]};ngds.publish("Layer.click",{Layer:a,tag_index:d})});$(".map-search-results").on("click",".visibility-toggler button",function(a){a.stopPropagation();var b=Number($(a.target).attr("data-seq"));ngds.Map.visibility_mgr.process(b)});ngds.Map.visibility_mgr={init:function(){var b=this;ngds.subscribe("Map.feature_processed",function(e,g){var f=function(i){ngds.Map.map.addLayer(i)};var h=function(i){ngds.Map.map.removeLayer(i)};b.features[g.seq]=b.construct_individual_mgr(g.feature,g.seq,f,h)});var c=function(f){for(var e in b.features){if(Number(e)!==0){b.features[e].show()}}$("button[data-seq='0']").removeClass("toggled")};var a=function(f){for(var e in b.features){if(Number(e)!==0){b.features[e].hide()}}$("button[data-seq='0']").addClass("toggled")};var d=b.construct_individual_mgr(null,0,c,a);b.features[0]=d},process:function(b){var a=this;if(a.features[b].is_hidden()){a.features[b].show()}else{a.features[b].hide()}},clearMgrs:function(){var a=this.features[0];this.features=[a]},features:{},construct_individual_mgr:function(c,g,e,f){var b=$("button[data-seq="+g+"]");var c=c;var d=false;var a={show:function(){e(c);b.removeClass("toggled");d=false},hide:function(){f(c);b.addClass("toggled");d=true},is_hidden:function(){return d}};return a}};ngds.Map.visibility_mgr.init()})();(function setup_styler_for_features(){ngds.subscribe("Layer.mouseover",function(a,c){if(typeof c.Layer==="undefined"||typeof c.Layer.layer==="undefined"){return}var b=c.Layer.layer.is_active||null;if(b===null||b===false){ngds.util.apply_feature_hover_styles(c.Layer.layer,c.tag_index)}});ngds.subscribe("Layer.mouseout",function(a,c){if(typeof c.Layer==="undefined"||typeof c.Layer.layer==="undefined"){return}var b=c.Layer.layer.is_active||null;if(b===null||b===false){ngds.util.apply_feature_default_styles(c.Layer.layer,c.tag_index)}});ngds.subscribe("Layer.click",function(d,f){if(typeof f.Layer==="undefined"||typeof f.Layer.layer==="undefined"){return}ngds.util.reset_result_styles();for(var b in ngds.layer_map){ngds.util.apply_feature_default_styles(ngds.layer_map[b],b);if(ngds.layer_map[b]._leaflet_id===f.Layer.layer._leaflet_id){ngds.layer_map[b].is_active=true}else{ngds.layer_map[b].is_active=false}}var a=f.Layer.layer._latlng||f.Layer.layer._latlngs;var c=(function(h){if(typeof h==="object"&&typeof h[0]==="undefined"){return h}var i=ngds.Map.utils.get_bound(h,"lat","min");var k=ngds.Map.utils.get_bound(h,"lat","max");var e=ngds.Map.utils.get_bound(h,"lng","min");var j=ngds.Map.utils.get_bound(h,"lng","max");return{lat:(i+k)/2,lng:(e+j)/2}})(a);ngds.Map.map.panTo(c);try{f.Layer.layer.openPopup()}catch(g){}ngds.util.apply_feature_active_styles(f.Layer,f.tag_index)});ngds.subscribe("Layer.add",function(a,b){});ngds.subscribe("Layer.remove",function(a,b){})})();(function setup_events_for_map_features(){ngds.subscribe("Map.add_feature",function(a,c){var b=c.feature;ngds.layer_map[c.seq_id]=b;ngds.util.apply_feature_default_styles(b,c.seq_id);ngds.feature_event_manager[b._leaflet_id]={Layer:b,seq_id:c.seq_id};ngds.publish("Map.layer_added",{});b.on("mouseover",function(d){ngds.publish("Layer.mouseover",{Layer:d,tag_index:c.seq_id})});b.on("mouseout",function(d){ngds.publish("Layer.mouseout",{Layer:d,tag_index:c.seq_id})});b.on("click",function(d){ngds.publish("Layer.click",{Layer:d,tag_index:c.seq_id})})})})();ngds.subscribe("Map.results_rendered",function(a,d){var c=ngds.util.state.map_features.map(function(g){var f=g.getBounds();var e=f.getSouthWest();var h=f.getNorthEast();return new L.LatLngBounds(e,h)});for(var b=0;b<c.length;b++){c[b].extend(c[b-1])}ngds.Map.map.fitBounds(c[c.length-1]);$(".visibility-managed").show();$(".results").jScrollPane({contentWidth:"0px",hideFocus:true})});ngds.subscribe("Map.results_hide",function(a,b){$(".visibility-managed").hide()});$(document).ready(function(){var a=false;$(".map-expander").on("click",function(){if(a===false){$(".visibility-managed").hide();a=true}else{$(".visibility-managed").show();a=false}})});(function(){ngds.subscribe("Map.size_changed",function(a,b){if(b.fullscreen===true){ngds.Map.state["map-search-results-left"]=$(".map-search-results").css("left");ngds.Map.state["map-search-results-top"]=$(".map-search-results").css("top");ngds.Map.state["map-search-left"]=$(".map-search").css("left");ngds.Map.state["map-search-top"]=$(".map-search").css("top");$(".map-search").css({left:"10px",position:"fixed"});$(".map-search-results").css({left:"10px",position:"fixed"})}else{$(".map-search").css({left:ngds.Map.state["map-search-left"],top:ngds.Map.state["map-search-top"],position:"absolute"});$(".map-search-results").css({left:ngds.Map.state["map-search-results-left"],top:ngds.Map.state["map-search-results-top"],position:"absolute"})}})})();$(document).ready(function(){ngds.Map.map.on("zoomend",ngds.util.make_prominent);$(".map-search").on("click",".wms",function(a){a.preventDefault();ckan.notify("Please wait while the Web Map Services you requested are fetched","","info");var b=$(this).attr("data-package-id");ngds.ckanlib.get_wms_urls(b,function(c){for(var g=0;g<c.length;g++){var d=c[g];var f={layers:d.layer,format:"image/png",transparent:true,attribution:"NGDS",tileSize:128,opacity:0.9999,version:"1.1.1"};var e=L.tileLayer.wms(d.url,f);ngds.Map.layer_control.addOverlay(e,d.layer);ngds.Map.map.addLayer(e)}ckan.notify("The Web Map Services you requested have been added to the map.","","success")});return false})});ngds.subscribe("Map.layer_added",function(){ngds.util.make_prominent()});