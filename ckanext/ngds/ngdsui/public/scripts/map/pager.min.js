ngds.util.state.drawn_rectangle=(function(){var g=null;var d=new L.LatLng(-90,-180),b=new L.LatLng(90,180),f=new L.LatLngBounds(d,b);var e=new ngds.Map.BoundingBox();e.store_raw(f);ngds.subscribe("Map.area_selected",function(i,h){if(h.type==="rectangle"){g=new ngds.Map.BoundingBox();g.construct_from_leaflet_shape(h.feature["rect"]);package_extras={ext_bbox:g.get_bbox_array().join(",")}}});ngds.subscribe("Map.clear_rect",function(i,h){ngds.Map.clear_layer("drawnItems");g=null});var c=function(){return e.get_bbox_array().join(",")};var a=function(){if(g===null){return c()}var h=g.get_bbox_array().join(",");return h};return{get:a}})();ngds.Search=function(){var a="";var d=this;var c=$(".search-results-page-nums");var b=function(j,l){var i="";var h=j.rows;var g=j.action;var f=j.page;ngds.Map.cur_page=f;var k=(f-1)*h;if(typeof j.q==="undefined"){i=d._q}else{d._q=j.q;i=d._q}ngds.Map.current_query=d._q;ngds.log("Searching for term : "+i+", rows : "+h+", page : "+f+" start : "+k);var e={ext_bbox:ngds.util.state.drawn_rectangle.get()};g({rows:h,q:i,start:k,extras:e},function(p){ngds.publish("Map.results_received",{results:p.result.results,query:ngds.Map.current_query,count:p.result.count});var s=ngds.Map.num_pages=Math.ceil(p.result.count/h);var r=$(".search-results-page-nums");var m=Number(ngds.Map.cur_page);var o=false;if(m!==1){r.append(ngds.util.dom_element_constructor({tag:"a",attributes:{"class":"page-num",text:"<"}}))}for(var q=1;q<s+1;q++){if((q!==m&&q!==1&&q!==s)&&(q<m-1||q>m+1)){if(o===false){r.append(ngds.util.dom_element_constructor({tag:"a",attributes:{"class":"page-num",text:"..."}}))}o=true;continue}var t=ngds.util.dom_element_constructor({tag:"a",attributes:{"class":"page-num",text:q}});r.append(t);if(parseInt(ngds.Map.cur_page)===q){var n=t;n.addClass("page-active")}}if(ngds.Map.num_pages-ngds.Map.cur_page!==0){r.append(ngds.util.dom_element_constructor({tag:"a",attributes:{"class":"page-num",text:">"}}))}})};return{go_to:b}};