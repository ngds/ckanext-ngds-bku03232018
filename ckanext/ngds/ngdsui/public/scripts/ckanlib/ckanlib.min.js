ngds.ckanlib={dataset_geo:function(c,d){var b="/api/2/search/dataset/geo?bbox=";if(!typeof c==="object"){throw"Parameter bbox : Expected a BoundingBox Object."}$.each(c.get_bbox_array(),function(f,e){(function(g){if(g===null||typeof g==="undefined"){throw"Missing parameter : Expected minx,miny,maxx,maxy."}})(e)});(function(){if(typeof d!=="function"){throw"Missing parameter : Expected callback function."}})();var a=b+c.get_bbox_array().join(",");$.ajax({url:a,type:"GET",dataType:"JSON",success:function(e){return d(e)}})},dataset_poly_geo:function(c,e){(function(){if(c===null||typeof c==="undefined"){throw"Missing parameter : Expected an array of coordinates representing a polygon."}if(typeof e!=="function"){throw"Missing parameter : Expected callback function."}})();if(c.length===0){return}var a="/poly";var d={data:JSON.stringify({poly:c})};var b="POST";$.ajax({url:a,data:d,success:function(f){return e(f)}})},package_show:function(c,d){(function(){if(c===null||typeof c==="undefined"){throw"Missing parameter : Expected package_id."}if(typeof d!=="function"){throw"Missing parameter : Expected callback function."}})();var a="/api/action/package_show";var b=JSON.stringify({id:c});$.ajax({url:a,type:"POST",dataType:"JSON",data:b,success:function(e){return d(e)}})},package_search:function(b,l){(function(){if(b!==null&&typeof b!=="undefined"){if(typeof b==="undefined"){throw"Expected an object as the second parameter."}}if(typeof l!=="function"){throw"Expected a callback function."}})();var k=null;var a=false;var h=b.q.split(" ");for(var f=0;f<h.length;f++){var m=h[f].replace(" ","").replace(" ","");if(m==="near"||m==="in"){a=true;break}}if(a===true){k=h.splice(f+1,h.length);var j=h.splice(0,f).join(" ");b.q=j;var n=new L.GeoSearch.Provider.OpenStreetMap();var d=n.GetServiceUrl(k);ngds.publish("data-loading",{});$.getJSON(d,function(u){var q=ngds.ckanlib.transform_neg;var p=ngds.ckanlib.transform_pos;var t=Math.min(q(u[0]["boundingbox"][0]),p(u[0]["boundingbox"][1]));var s=Math.max(q(u[0]["boundingbox"][0]),p(u[0]["boundingbox"][1]));var r=Math.min(q(u[0]["boundingbox"][2]),p(u[0]["boundingbox"][3]));var o=Math.max(q(u[0]["boundingbox"][2]),p(u[0]["boundingbox"][3]));var i=r+","+t+","+o+","+s;new L.rectangle([[t,r],[s,o]],{color:"green",dashArray:"5,5",weight:"3",opacity:1,fillOpacity:0}).addTo(ngds.Map.geoJSONLayer);b.extras["ext_bbox"]=i;ngds.ckanlib.package_search(b,function(v){ngds.publish("data-loaded",{});return l(v)})});return}ngds.publish("data-loading",{});var c="/api/action/package_search";var g="POST";var e={sort:""};for(key in b){if(b[key]!==null&&typeof b[key]!=="undefined"){e[key]=b[key]}}$.ajax({url:c,type:g,dataType:"JSON",data:JSON.stringify(e),success:function(i){ngds.publish("data-loaded",{});return l(i)}})},transform_neg:function(d){var b=Number(d);var a=0;if(b<0){a=-(Math.abs(b)+2)}else{a=b-2}return a},transform_pos:function(d){var b=Number(d);var a=0;if(b<0){a=-(Math.abs(b)-2)}else{a=b+2}return a},get_responsible_party:function(f,e){(function(){if(f===null||typeof f==="undefined"){throw"Expected valid id"}if(typeof e!=="function"){throw"Expected callback function"}})();var b="/api/action/additional_metadata";var a="ResponsibleParty";var d="read";var c={model:a,process:d,data:{id:f}};$.ajax({url:b,data:c,success:function(g){return e(g)}})},datastore_search:function(a,b){if(typeof a==="undefined"||a===null){throw"Expected resource id. Got nothing."}if(typeof b!=="function"||b===null){throw"Expected callback function. Got nothing."}$.ajax({url:"/api/3/action/datastore_search",data:{resource_id:a},dataType:"jsonp",success:function(c){return b(c)}})},publish_to_geoserver:function(a){$.ajax({url:"/api/action/geoserver_publish_layer",type:"POST",data:JSON.stringify({gs_lyr_name:a.layer_name,resource_id:a.resource_id,package_id:a.package_id,col_geography:a.col_geo,col_latitude:a.col_lat,col_longitude:a.col_lng}),success:function(b){a.callback({response:b,status:"success"})},error:function(){a.callback({status:"failure"})}})},unpublish_layer:function(a){$.ajax({url:"/api/action/geoserver_unpublish_layer",type:"POST",data:JSON.stringify({resource_id:a.resource_id,gs_lyr_name:a.layer_name}),success:function(b){a.callback({response:b,status:"success"})},error:function(){a.callback({status:"failure"})}})},get_wms_urls:function(a,b){$.ajax({url:"/api/action/get_wms_for_pkg",type:"POST",data:JSON.stringify({pkg_id:a}),success:function(c){return b(c.result)},error:function(){}})}};